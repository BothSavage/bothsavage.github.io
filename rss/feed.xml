<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Both Savage</title>
        <link>https://bothsavage.github.io//</link>
        <description>一个NotionNext搭建的博客</description>
        <lastBuildDate>Fri, 02 May 2025 10:48:13 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en-US</language>
        <copyright>All rights reserved 2025, Both Savage</copyright>
        <item>
            <title><![CDATA[部署Kimi-VL-A3B-Instruct视频推理]]></title>
            <link>https://bothsavage.github.io//article/250421-kimi-vl</link>
            <guid>https://bothsavage.github.io//article/250421-kimi-vl</guid>
            <pubDate>Sun, 20 Apr 2025 16:00:00 GMT</pubDate>
            <description><![CDATA[最近国内AI公司月之暗面推出了Kimi-VL开源视觉模型。模型参数16.4B，但是推理时候激活参数2.8B。看了huggingface主页的Full comparison，在多项Benchmark的时候都展示出了不俗的实力。由于业务中使用了qwen-vl-2.5-7B，所以测试下Kimi-VL-A3B-Instruct是否在更小的部署资源中拥有更好的表现。]]></description>
            <content:encoded><![CDATA[<div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-1dcf501017f280b2ae5ce24e892f0228"><div class="notion-viewport"></div><div class="notion-collection-page-properties"></div><div class="notion-blank notion-block-1dcf501017f2803395b2d8736b7a915e"> </div><div class="notion-table-of-contents notion-gray notion-block-1dcf501017f2806d8e92ca6a51cf2667"><a href="#1dcf501017f280e989acd686730a692d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">契机</span></a><a href="#1dcf501017f28017bb1af6f47987d553" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">安装</span></a><a href="#1dcf501017f2800f8e66ed9d05a35e93" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">图片推理测试</span></a><a href="#1dcf501017f28007b1eed16ab0fc44b6" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">代码</span></a><a href="#1dcf501017f2807aa518fad7a8bebe01" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">输入输出</span></a><a href="#1dcf501017f28080be40e255d212b8e7" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">资源占用</span></a><a href="#1dcf501017f2800691d8c296bb1fdc9d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">视频推理测试</span></a><a href="#1dcf501017f280a48d65d1ff369f1880" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">代码</span></a><a href="#1dcf501017f2805d9e13f3c7357d964d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">输入输出</span></a><a href="#1dcf501017f28026a58ccd7a4da7226c" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">资源占用</span></a><a href="#1dcf501017f2807e9c76c2ca961d40d1" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">总结</span></a><a href="#1dcf501017f28052bdcec8cc5a599644" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">写到最后</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1dcf501017f280e989acd686730a692d" data-id="1dcf501017f280e989acd686730a692d"><span><div id="1dcf501017f280e989acd686730a692d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f280e989acd686730a692d" title="契机"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">契机</span></span></h2><div class="notion-callout notion-gray_background_co notion-block-1dcf501017f280ffa9b9d07b9b34560f"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="⚙">⚙</span></div><div class="notion-callout-text">最近国内AI公司月之暗面推出了<b>Kimi-VL</b>开源视觉模型。模型参数16.4B，但是推理时候激活参数2.8B。看了huggingface主页的Full comparison，在多项<b>Benchmark</b>的时候都展示出了不俗的实力。由于业务中使用了qwen-vl-2.5-7B，所以测试下<b>Kimi-VL-A3B-Instruct</b>是否在更小的部署资源中拥有更好的表现。</div></div><div class="notion-blank notion-block-1dcf501017f280a3b2b1fdd7eab09f1e"> </div><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-1dcf501017f280389609fd4fe3839fe6" href="https://huggingface.co/moonshotai/Kimi-VL-A3B-Instruct"><div><div class="notion-bookmark-title">moonshotai/Kimi-VL-A3B-Instruct · Hugging Face</div><div class="notion-bookmark-description">We’re on a journey to advance and democratize artificial intelligence through open source and open science.</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><img src="https://www.notion.so/image/https%3A%2F%2Fhuggingface.co%2Ffavicon.ico?table=block&amp;id=1dcf5010-17f2-8038-9609-fd4fe3839fe6&amp;t=1dcf5010-17f2-8038-9609-fd4fe3839fe6" alt="moonshotai/Kimi-VL-A3B-Instruct · Hugging Face" loading="lazy" decoding="async"/></div><div class="notion-bookmark-link-text">https://huggingface.co/moonshotai/Kimi-VL-A3B-Instruct</div></div></div><div class="notion-bookmark-image"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fcdn-thumbnails.huggingface.co%2Fsocial-thumbnails%2Fmodels%2Fmoonshotai%2FKimi-VL-A3B-Instruct.png?table=block&amp;id=1dcf5010-17f2-8038-9609-fd4fe3839fe6&amp;t=1dcf5010-17f2-8038-9609-fd4fe3839fe6" alt="moonshotai/Kimi-VL-A3B-Instruct · Hugging Face" loading="lazy" decoding="async"/></div></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1dcf501017f28017bb1af6f47987d553" data-id="1dcf501017f28017bb1af6f47987d553"><span><div id="1dcf501017f28017bb1af6f47987d553" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f28017bb1af6f47987d553" title="安装"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">安装</span></span></h2><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1dcf501017f2800f8e66ed9d05a35e93" data-id="1dcf501017f2800f8e66ed9d05a35e93"><span><div id="1dcf501017f2800f8e66ed9d05a35e93" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f2800f8e66ed9d05a35e93" title="图片推理测试"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">图片推理测试</span></span></h2><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1dcf501017f28007b1eed16ab0fc44b6" data-id="1dcf501017f28007b1eed16ab0fc44b6"><span><div id="1dcf501017f28007b1eed16ab0fc44b6" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f28007b1eed16ab0fc44b6" title="代码"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">代码</span></span></h4><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1dcf501017f2807aa518fad7a8bebe01" data-id="1dcf501017f2807aa518fad7a8bebe01"><span><div id="1dcf501017f2807aa518fad7a8bebe01" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f2807aa518fad7a8bebe01" title="输入输出"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">输入输出</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-1dcf501017f2809bb1efc2710cea35a8"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/attachment%3Ab5eb38ee-1bc3-4a21-ae48-b09f9e060877%3Aimage.png?table=block&amp;id=1dcf5010-17f2-809b-b1ef-c2710cea35a8&amp;t=1dcf5010-17f2-809b-b1ef-c2710cea35a8" alt="notion image" loading="lazy" decoding="async"/></div></figure><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1dcf501017f28080be40e255d212b8e7" data-id="1dcf501017f28080be40e255d212b8e7"><span><div id="1dcf501017f28080be40e255d212b8e7" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f28080be40e255d212b8e7" title="资源占用"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">资源占用</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-1dcf501017f280b2b95df0da8c235532"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:548.96875px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/attachment%3A1ea008dd-4d11-4d71-906c-a4176bd936cf%3Aimage.png?table=block&amp;id=1dcf5010-17f2-80b2-b95d-f0da8c235532&amp;t=1dcf5010-17f2-80b2-b95d-f0da8c235532" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1dcf501017f2800691d8c296bb1fdc9d" data-id="1dcf501017f2800691d8c296bb1fdc9d"><span><div id="1dcf501017f2800691d8c296bb1fdc9d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f2800691d8c296bb1fdc9d" title="视频推理测试"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">视频推理测试</span></span></h2><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1dcf501017f280a48d65d1ff369f1880" data-id="1dcf501017f280a48d65d1ff369f1880"><span><div id="1dcf501017f280a48d65d1ff369f1880" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f280a48d65d1ff369f1880" title="代码"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">代码</span></span></h4><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1dcf501017f2805d9e13f3c7357d964d" data-id="1dcf501017f2805d9e13f3c7357d964d"><span><div id="1dcf501017f2805d9e13f3c7357d964d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f2805d9e13f3c7357d964d" title="输入输出"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">输入输出</span></span></h4><h4 class="notion-h notion-h3 notion-h-indent-1 notion-block-1dcf501017f28026a58ccd7a4da7226c" data-id="1dcf501017f28026a58ccd7a4da7226c"><span><div id="1dcf501017f28026a58ccd7a4da7226c" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f28026a58ccd7a4da7226c" title="资源占用"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">资源占用</span></span></h4><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-1dcf501017f2806fa147f625a8c6ada8"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/attachment%3Accf70cbe-df2a-4ed8-ba4b-0be2d8af37e3%3Aimage.png?table=block&amp;id=1dcf5010-17f2-806f-a147-f625a8c6ada8&amp;t=1dcf5010-17f2-806f-a147-f625a8c6ada8" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1dcf501017f2807e9c76c2ca961d40d1" data-id="1dcf501017f2807e9c76c2ca961d40d1"><span><div id="1dcf501017f2807e9c76c2ca961d40d1" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f2807e9c76c2ca961d40d1" title="总结"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">总结</span></span></h2><ul class="notion-list notion-list-disc notion-block-1dcf501017f280da8670f9d5a0925333"><li>这个显存占用也不低啊</li></ul><ul class="notion-list notion-list-disc notion-block-1dcf501017f2805eabddcc1ff9be57fb"><li>纯记录</li></ul><div class="notion-blank notion-block-1dcf501017f280849962d1ba7b7b96ef"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1dcf501017f28052bdcec8cc5a599644" data-id="1dcf501017f28052bdcec8cc5a599644"><span><div id="1dcf501017f28052bdcec8cc5a599644" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1dcf501017f28052bdcec8cc5a599644" title="写到最后"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">写到最后</span></span></h2><div class="notion-row notion-block-1dcf501017f2801e96bbf7444e4460f8"><div class="notion-column notion-block-1dcf501017f280299c63d779ecc05b09" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.25)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-1dcf501017f280eba662dc29d592b792"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fe74a26b9-10d9-49f3-9ea7-bcb2a1438bd7%2Ffavicon.png?table=block&amp;id=1dcf5010-17f2-80eb-a662-dc29d592b792&amp;t=1dcf5010-17f2-80eb-a662-dc29d592b792&amp;width=144&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-1dcf501017f2807eaa5ae720e4d1edbc" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.34601449275362306)"><div class="notion-text notion-block-1dcf501017f28070a765c433a3f8a962"><em>
</em><em><b>        是在往前走就好</b></em><em>
        </em><em><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://bothsavage.github.io/archive">bothsavage.github.io</a></em><em>
</em></div><div class="notion-blank notion-block-1dcf501017f2800b8ddcdbc12c6b983f"> </div></div><div class="notion-spacer"></div><div class="notion-column notion-block-1dcf501017f280feac0ada0fc71214d9" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.4039855072463767)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-1dcf501017f2801fb249f228edd373af"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:315px"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3436ffe0-3684-445a-824f-2fd9fa5ad2a6%2FUntitled.png?table=block&amp;id=1dcf5010-17f2-801f-b249-f228edd373af&amp;t=1dcf5010-17f2-801f-b249-f228edd373af&amp;width=288&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div></div><div class="notion-blank notion-block-1dcf501017f2802dbcfcfaaf71a640d2"> </div></main></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Knife4j在Gateway下的URI优化以及热刷新]]></title>
            <link>https://bothsavage.github.io//article/241223-knife4j</link>
            <guid>https://bothsavage.github.io//article/241223-knife4j</guid>
            <pubDate>Mon, 23 Dec 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[之前在做Gateway集成knife4j的时候。发现uri的地址缺少了项目路径，也就是baseURI，本篇文章就是在处理这个问题。还有gateway一旦启动会固化服务列表，加了一个小改动动态刷新服务列表，这样不用每次在最后重启gateway。]]></description>
            <content:encoded><![CDATA[<div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-165f501017f2804696d3cf4f764e9caf"><div class="notion-viewport"></div><div class="notion-collection-page-properties"></div><div class="notion-table-of-contents notion-gray notion-block-165f501017f281909703cd9e50193706"><a href="#165f501017f281cf80e2cd84a6e2f5b9" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">契机</span></a><a href="#165f501017f28108b87ae91256790ad1" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">添加BaseURI</span></a><a href="#165f501017f28188923de13b2c94964b" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">动态刷新服务列表</span></a><a href="#165f501017f2818085bcc796a82b3b63" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">总结</span></a><a href="#165f501017f28184aca4e1de994448c6" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">写到最后</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-165f501017f281cf80e2cd84a6e2f5b9" data-id="165f501017f281cf80e2cd84a6e2f5b9"><span><div id="165f501017f281cf80e2cd84a6e2f5b9" class="notion-header-anchor"></div><a class="notion-hash-link" href="#165f501017f281cf80e2cd84a6e2f5b9" title="契机"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">契机</span></span></h2><div class="notion-callout notion-gray_background_co notion-block-165f501017f281e1bcd3c077041a1271"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="⚙">⚙</span></div><div class="notion-callout-text">（遗留输出）最近在整理之前的笔记，逐渐梳理成文章输出到博客网站。之前在做Gateway集成knife4j的时候。发现uri的地址缺少了项目路径，也就是baseURI，本篇文章就是在处理这个问题。还有gateway一旦启动会固化服务列表，加了一个小改动动态刷新服务列表，这样不用每次在最后重启gateway。</div></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-165f501017f28108b87ae91256790ad1" data-id="165f501017f28108b87ae91256790ad1"><span><div id="165f501017f28108b87ae91256790ad1" class="notion-header-anchor"></div><a class="notion-hash-link" href="#165f501017f28108b87ae91256790ad1" title="添加BaseURI"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">添加BaseURI</span></span></h2><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-165f501017f28188923de13b2c94964b" data-id="165f501017f28188923de13b2c94964b"><span><div id="165f501017f28188923de13b2c94964b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#165f501017f28188923de13b2c94964b" title="动态刷新服务列表"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">动态刷新服务列表</span></span></h2><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-165f501017f2818085bcc796a82b3b63" data-id="165f501017f2818085bcc796a82b3b63"><span><div id="165f501017f2818085bcc796a82b3b63" class="notion-header-anchor"></div><a class="notion-hash-link" href="#165f501017f2818085bcc796a82b3b63" title="总结"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">总结</span></span></h2><ul class="notion-list notion-list-disc notion-block-165f501017f281039466e3caf045bf3a"><li>有点水</li></ul><ul class="notion-list notion-list-disc notion-block-165f501017f28039944bf526bb2ade12"><li>纯记录，后续都使用apifox了</li></ul><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-165f501017f28184aca4e1de994448c6" data-id="165f501017f28184aca4e1de994448c6"><span><div id="165f501017f28184aca4e1de994448c6" class="notion-header-anchor"></div><a class="notion-hash-link" href="#165f501017f28184aca4e1de994448c6" title="写到最后"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">写到最后</span></span></h2><div class="notion-row notion-block-165f501017f281f3900af448109a33bf"><div class="notion-column notion-block-165f501017f281089210d11763b2f52a" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.25)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-165f501017f281ca9f34ecf367df1b34"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fe74a26b9-10d9-49f3-9ea7-bcb2a1438bd7%2Ffavicon.png?table=block&amp;id=165f5010-17f2-81ca-9f34-ecf367df1b34&amp;t=165f5010-17f2-81ca-9f34-ecf367df1b34&amp;width=144&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-165f501017f281b6b581f78f787c50df" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.34601449275362306)"><div class="notion-text notion-block-165f501017f281d18b69d5d76dee36b7"><em>
</em><em><b>        是在往前走就好</b></em><em>
        </em><em><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://bothsavage.github.io/archive">bothsavage.github.io</a></em><em>
</em></div><div class="notion-blank notion-block-165f501017f281c7aa84db0617bbe7b6"> </div></div><div class="notion-spacer"></div><div class="notion-column notion-block-165f501017f281a39648d5e96a5bdce0" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.4039855072463767)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-165f501017f281b1a88ccd00181f390e"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:315px"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3436ffe0-3684-445a-824f-2fd9fa5ad2a6%2FUntitled.png?table=block&amp;id=165f5010-17f2-81b1-a88c-cd00181f390e&amp;t=165f5010-17f2-81b1-a88c-cd00181f390e&amp;width=288&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div></div><div class="notion-blank notion-block-165f501017f2817c9425cc64e69f4c87"> </div></main></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Java部署脚本&重启备份检查&配置环境]]></title>
            <link>https://bothsavage.github.io//article/240124-deploy</link>
            <guid>https://bothsavage.github.io//article/240124-deploy</guid>
            <pubDate>Tue, 23 Jan 2024 16:00:00 GMT</pubDate>
            <description><![CDATA[微服务jar包越来越多,每次手动上线的时候都要运行一大堆命令,并且每个人备份的jar包名称目录都不一样。故写了一个脚本规定死流程,并且把脚本配置到环境变量做自动补全。]]></description>
            <content:encoded><![CDATA[<div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-38e3f997dad946b899bbd3042488821f"><div class="notion-viewport"></div><div class="notion-collection-page-properties"></div><div class="notion-table-of-contents notion-gray notion-block-30cd1b5d9c764661bb28c4f7511b9c0c"><a href="#c4f68ef2bdba42b2829c2443f5de269d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">契机</span></a><a href="#6dc7d2472acb4e17979f2751e11a4866" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">命令编写步骤</span></a><a href="#8513dc44acdd416c97975a429313055a" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">配置环境变量</span></a><a href="#316c39c8874f4c268b20c27d7df00e22" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">主程序</span></a><a href="#e50a06de71d542a584f972dba14b6249" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">辅助函数</span></a><a href="#1c461f9febc0408dbd62cd2d593df5ff" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">动态设置JVM参数</span></a><a href="#547f54ed12384e1e89ef996809620f35" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">根据jar包获取正在运行的pid列表</span></a><a href="#6d929a3430414f19acdbc1db601c49dc" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">停止服务</span></a><a href="#d23b738a497745dd9e874ac4299f8a2c" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">启动服务</span></a><a href="#8d850969c7f1427891897b8a880d6922" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">启动完成检查</span></a><a href="#2c676e2583254e28a93c2a14c18c16f9" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">备份</span></a><a href="#dae3dcc69abb45e78cd096e67fb23514" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">环境变量配置</span></a><a href="#d044fa9043bf464bb804b1952f91548b" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">配置~/.bash_profile</span></a><a href="#12211a141feb449bbeababea67e70635" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">配置自动补全</span></a><a href="#af722408abb3480e9546752a8866c509" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">效果</span></a><a href="#0cdbdf1b35ba440492353d8625c1eac0" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">备份</span></a><a href="#8566becf9f134e17800f8c73a9d69d10" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">重启</span></a><a href="#1af189564491464688128c26899d094c" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">最终部署脚本</span></a><a href="#3b508db8425b4c7783d09eba50c4ef24" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">写到最后</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-c4f68ef2bdba42b2829c2443f5de269d" data-id="c4f68ef2bdba42b2829c2443f5de269d"><span><div id="c4f68ef2bdba42b2829c2443f5de269d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#c4f68ef2bdba42b2829c2443f5de269d" title="契机"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">契机</span></span></h2><div class="notion-callout notion-gray_background_co notion-block-de75e7b797b74bbaacf9c9a53bb46ac7"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="⚙">⚙</span></div><div class="notion-callout-text">微服务jar包越来越多,每次手动上线的时候都要运行一大堆命令,并且每个人备份的jar包名称目录都不一样。故写了一个脚本规定死流程,并且把脚本配置到环境变量做自动补全。
固定流程：deploy bakup xx.jar —&gt; deploy restart xx.jar</div></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-6dc7d2472acb4e17979f2751e11a4866" data-id="6dc7d2472acb4e17979f2751e11a4866"><span><div id="6dc7d2472acb4e17979f2751e11a4866" class="notion-header-anchor"></div><a class="notion-hash-link" href="#6dc7d2472acb4e17979f2751e11a4866" title="命令编写步骤"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">命令编写步骤</span></span></h2><blockquote class="notion-quote notion-block-ec124e1df2124b30b0196c0b3819fb0e"><div>我会把每一步编写的用途都罗列出来,不想看的可以直接滑到最后复制整个脚本</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-8513dc44acdd416c97975a429313055a" data-id="8513dc44acdd416c97975a429313055a"><span><div id="8513dc44acdd416c97975a429313055a" class="notion-header-anchor"></div><a class="notion-hash-link" href="#8513dc44acdd416c97975a429313055a" title="配置环境变量"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">配置环境变量</span></span></h3><blockquote class="notion-quote notion-block-b1f5373e66e34e3b8df60436ece58f30"><div>这里配置基础的java运行环境变量，包括可以把JVM运行参数也放在这里，到我项目里面的JVM参数是变动的，下面会提到。并且声明脚本要用到变量。</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-316c39c8874f4c268b20c27d7df00e22" data-id="316c39c8874f4c268b20c27d7df00e22"><span><div id="316c39c8874f4c268b20c27d7df00e22" class="notion-header-anchor"></div><a class="notion-hash-link" href="#316c39c8874f4c268b20c27d7df00e22" title="主程序"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">主程序</span></span></h3><blockquote class="notion-quote notion-block-8e2a4be9ddd043c890a173e5966dc430"><div>首先定义程序入口，运行welcome欢迎函数，并且运行检查当前工作目录函数，因为这个脚本会在配置到环境变量，防止程序运行报错。</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-e50a06de71d542a584f972dba14b6249" data-id="e50a06de71d542a584f972dba14b6249"><span><div id="e50a06de71d542a584f972dba14b6249" class="notion-header-anchor"></div><a class="notion-hash-link" href="#e50a06de71d542a584f972dba14b6249" title="辅助函数"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">辅助函数</span></span></h3><blockquote class="notion-quote notion-block-3f65869a70fa433ebfde8dbdca631b9f"><div>提示函数，检查输入参数，welcome，check_directory等，都比较简单</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-1c461f9febc0408dbd62cd2d593df5ff" data-id="1c461f9febc0408dbd62cd2d593df5ff"><span><div id="1c461f9febc0408dbd62cd2d593df5ff" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1c461f9febc0408dbd62cd2d593df5ff" title="动态设置JVM参数"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">动态设置JVM参数</span></span></h3><blockquote class="notion-quote notion-block-263f23a4ae614c82b821dccdf0fa6e4c"><div>根据env环境变量和jar包的名称动态设置JVM的堆内存</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-547f54ed12384e1e89ef996809620f35" data-id="547f54ed12384e1e89ef996809620f35"><span><div id="547f54ed12384e1e89ef996809620f35" class="notion-header-anchor"></div><a class="notion-hash-link" href="#547f54ed12384e1e89ef996809620f35" title="根据jar包获取正在运行的pid列表"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">根据jar包获取正在运行的pid列表</span></span></h3><blockquote class="notion-quote notion-block-77b75914f02a4393bd36453671da3504"><div>就是ps aux ｜ grep 服务名来获取的正在运行的pid，然后通过awk来输出具体的某个pid</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-6d929a3430414f19acdbc1db601c49dc" data-id="6d929a3430414f19acdbc1db601c49dc"><span><div id="6d929a3430414f19acdbc1db601c49dc" class="notion-header-anchor"></div><a class="notion-hash-link" href="#6d929a3430414f19acdbc1db601c49dc" title="停止服务"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">停止服务</span></span></h3><blockquote class="notion-quote notion-block-f5002c9f33304c7491e42bd2be6cc9df"><div>使用kill -15来杀程序，如果超过60s，就直接kill -9</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-d23b738a497745dd9e874ac4299f8a2c" data-id="d23b738a497745dd9e874ac4299f8a2c"><span><div id="d23b738a497745dd9e874ac4299f8a2c" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d23b738a497745dd9e874ac4299f8a2c" title="启动服务"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">启动服务</span></span></h3><blockquote class="notion-quote notion-block-dd5cbc1b79404623b4e1372257a167fd"><div>这里无非就是组装最终运行的部署语句</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-8d850969c7f1427891897b8a880d6922" data-id="8d850969c7f1427891897b8a880d6922"><span><div id="8d850969c7f1427891897b8a880d6922" class="notion-header-anchor"></div><a class="notion-hash-link" href="#8d850969c7f1427891897b8a880d6922" title="启动完成检查"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">启动完成检查</span></span></h3><blockquote class="notion-quote notion-block-85c59e465afc44f78d9224dfdb79e418"><div>由于我的java项目一般会把info级别的日志文件放在同级目录，通过检测关键字来实现启动完成监控</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-2c676e2583254e28a93c2a14c18c16f9" data-id="2c676e2583254e28a93c2a14c18c16f9"><span><div id="2c676e2583254e28a93c2a14c18c16f9" class="notion-header-anchor"></div><a class="notion-hash-link" href="#2c676e2583254e28a93c2a14c18c16f9" title="备份"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">备份</span></span></h3><blockquote class="notion-quote notion-block-aa4dcc5295a647a488e5b4275689bcda"><div>自动备份到指定目录，并且做到限制备份数目，自动清除等效果</div></blockquote><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-dae3dcc69abb45e78cd096e67fb23514" data-id="dae3dcc69abb45e78cd096e67fb23514"><span><div id="dae3dcc69abb45e78cd096e67fb23514" class="notion-header-anchor"></div><a class="notion-hash-link" href="#dae3dcc69abb45e78cd096e67fb23514" title="环境变量配置"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">环境变量配置</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-d044fa9043bf464bb804b1952f91548b" data-id="d044fa9043bf464bb804b1952f91548b"><span><div id="d044fa9043bf464bb804b1952f91548b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#d044fa9043bf464bb804b1952f91548b" title="配置~/.bash_profile"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">配置~/.bash_profile</span></span></h3><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-12211a141feb449bbeababea67e70635" data-id="12211a141feb449bbeababea67e70635"><span><div id="12211a141feb449bbeababea67e70635" class="notion-header-anchor"></div><a class="notion-hash-link" href="#12211a141feb449bbeababea67e70635" title="配置自动补全"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">配置自动补全</span></span></h3><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-af722408abb3480e9546752a8866c509" data-id="af722408abb3480e9546752a8866c509"><span><div id="af722408abb3480e9546752a8866c509" class="notion-header-anchor"></div><a class="notion-hash-link" href="#af722408abb3480e9546752a8866c509" title="效果"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">效果</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-0cdbdf1b35ba440492353d8625c1eac0" data-id="0cdbdf1b35ba440492353d8625c1eac0"><span><div id="0cdbdf1b35ba440492353d8625c1eac0" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0cdbdf1b35ba440492353d8625c1eac0" title="备份"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">备份</span></span></h3><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-23f697fbec304920becfb2569bb235d0"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F9007636a-7168-467c-bccd-fcf31712bf3d%2FUntitled.png?table=block&amp;id=23f697fb-ec30-4920-becf-b2569bb235d0&amp;t=23f697fb-ec30-4920-becf-b2569bb235d0&amp;width=707.984375&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-8566becf9f134e17800f8c73a9d69d10" data-id="8566becf9f134e17800f8c73a9d69d10"><span><div id="8566becf9f134e17800f8c73a9d69d10" class="notion-header-anchor"></div><a class="notion-hash-link" href="#8566becf9f134e17800f8c73a9d69d10" title="重启"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">重启</span></span></h3><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-6fc3b1c1279c4da39b48a286c69a4620"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Ff7983c27-0d6c-4279-9ec4-753138725f56%2FUntitled.png?table=block&amp;id=6fc3b1c1-279c-4da3-9b48-a286c69a4620&amp;t=6fc3b1c1-279c-4da3-9b48-a286c69a4620&amp;width=707.96875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-ebb9c14c457346739f41923621db6503"> </div><div class="notion-blank notion-block-5f09bd2041524fbf92346358f7ca9002"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-1af189564491464688128c26899d094c" data-id="1af189564491464688128c26899d094c"><span><div id="1af189564491464688128c26899d094c" class="notion-header-anchor"></div><a class="notion-hash-link" href="#1af189564491464688128c26899d094c" title="最终部署脚本"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">最终部署脚本</span></span></h2><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-3b508db8425b4c7783d09eba50c4ef24" data-id="3b508db8425b4c7783d09eba50c4ef24"><span><div id="3b508db8425b4c7783d09eba50c4ef24" class="notion-header-anchor"></div><a class="notion-hash-link" href="#3b508db8425b4c7783d09eba50c4ef24" title="写到最后"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">写到最后</span></span></h2><div class="notion-row notion-block-dffd5b0d8df5439996a363793dbd16d0"><div class="notion-column notion-block-01d7439919844db8b23271694c4f7aef" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.25)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-339737bc36d64e00ae149b1855021a83"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fe74a26b9-10d9-49f3-9ea7-bcb2a1438bd7%2Ffavicon.png?table=block&amp;id=339737bc-36d6-4e00-ae14-9b1855021a83&amp;t=339737bc-36d6-4e00-ae14-9b1855021a83&amp;width=144&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-5e5d53414a47448bbb23a0f7ba9ad5f7" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.34601449275362306)"><div class="notion-text notion-block-4a3120f5b7d044469360a24bc5d2a6ed"><em>
</em><b><em>        是在往前走就好</em></b><em>
        </em><em><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://bothsavage.github.io/archive">bothsavage.github.io</a></em><em>
</em></div><div class="notion-blank notion-block-a3e87d8721dd406d8b6f18e04e3330d5"> </div></div><div class="notion-spacer"></div><div class="notion-column notion-block-056999bab1624bddb94f66abf2db1bdf" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.4039855072463767)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-85f4203bc3c44987a73d4830494b33be"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:315px"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3436ffe0-3684-445a-824f-2fd9fa5ad2a6%2FUntitled.png?table=block&amp;id=85f4203b-c3c4-4987-a73d-4830494b33be&amp;t=85f4203b-c3c4-4987-a73d-4830494b33be&amp;width=288&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div></div><div class="notion-blank notion-block-70a67ed3e2b54bd8b6acde461ad7aa16"> </div></main></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[地瓜RDK X5上手ollama大模型测试]]></title>
            <link>https://bothsavage.github.io//article/241206-rdk</link>
            <guid>https://bothsavage.github.io//article/241206-rdk</guid>
            <pubDate>Thu, 05 Dec 2024 16:00:00 GMT</pubDate>
            <description><![CDATA[上次逛ollama的时候发现有很多小参数的大模型，比如qwen2:0.5b,llama3.2:1b，甚至还有一个1.8b的多模态模型moondream，找公司1拿到一块RDK X5的开发板，官网查看算力可达10TOPS，不懂这个算力是啥级别，也没做过iot平台的开发，但看系统是ubuntu，那问题不大，直接装ollama来跑，调研下个版本的智能硬件。]]></description>
            <content:encoded><![CDATA[<div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-154f501017f28079beb8c6a44f0aa69c"><div class="notion-viewport"></div><div class="notion-collection-page-properties"></div><div class="notion-blank notion-block-154f501017f281d7b8a6d1ec508228b7"> </div><div class="notion-table-of-contents notion-gray notion-block-154f501017f28113bf34e712ed6b2097"><a href="#154f501017f2817b8476fe64ebfe8256" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">契机</span></a><a href="#154f501017f28101a443d1c4a4e9f6f9" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">硬件烧录</span></a><a href="#154f501017f28149a7dbc3110729f8ab" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">进入系统</span></a><a href="#154f501017f280b8b31fca5f116e2304" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">设置wifi</span></a><a href="#154f501017f2801ca915df7d512f9c85" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">设置vnc
</span></a><a href="#154f501017f28038ac96c140e53cc7d0" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">测试ollama</span></a><a href="#154f501017f28027bbc8f0b2a69b5e57" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">安装</span></a><a href="#154f501017f280149161d508012fead1" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">测试结果</span></a><a href="#154f501017f281618d22e0b367832833" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">总结</span></a><a href="#154f501017f281ddb3f6dbff7965c44e" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">写到最后</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-154f501017f2817b8476fe64ebfe8256" data-id="154f501017f2817b8476fe64ebfe8256"><span><div id="154f501017f2817b8476fe64ebfe8256" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f2817b8476fe64ebfe8256" title="契机"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">契机</span></span></h2><div class="notion-callout notion-gray_background_co notion-block-154f501017f281cb97e2d37ef97bef34"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="⚙">⚙</span></div><div class="notion-callout-text">上次逛ollama的时候发现有很多小参数的大模型，比如qwen2:0.5b,llama3.2:1b，甚至还有一个1.8b的多模态模型moondream，找公司1拿到一块RDK X5的开发板，官网查看算力可达10TOPS，不懂这个算力是啥级别，也没做过iot平台的开发，但看系统是ubuntu，那问题不大，直接装ollama来跑，调研下个版本的智能硬件。</div></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-154f501017f28101a443d1c4a4e9f6f9" data-id="154f501017f28101a443d1c4a4e9f6f9"><span><div id="154f501017f28101a443d1c4a4e9f6f9" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f28101a443d1c4a4e9f6f9" title="硬件烧录"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">硬件烧录</span></span></h2><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-154f501017f280af8e27e679459a0b63" href="https://developer.d-robotics.cc/rdk_doc/Quick_start/install_os/rdk_x5"><div><div class="notion-bookmark-title">RDK DOC</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><img src="https://www.notion.so/image/https%3A%2F%2Fdeveloper.d-robotics.cc%2Frdk_doc%2Fimg%2Flogo.png?table=block&amp;id=154f5010-17f2-80af-8e27-e679459a0b63&amp;t=154f5010-17f2-80af-8e27-e679459a0b63" alt="RDK DOC" loading="lazy" decoding="async"/></div><div class="notion-bookmark-link-text">https://developer.d-robotics.cc/rdk_doc/Quick_start/install_os/rdk_x5</div></div></div></a></div><ul class="notion-list notion-list-disc notion-block-154f501017f280808364e518a762df40"><li>准备至少8GB容量的Micro SD卡</li></ul><ul class="notion-list notion-list-disc notion-block-154f501017f280359c6ce0508c7c2a70"><li>SD 读卡器</li></ul><ul class="notion-list notion-list-disc notion-block-154f501017f280e891afd24fba78109f"><li>下载镜像烧录工具balenaEtcher,<code class="notion-inline-code">https://etcher.balena.io/#download-etcher</code></li></ul><ul class="notion-list notion-list-disc notion-block-154f501017f280919521e430ba8524d2"><li>下载镜像：<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://archive.d-robotics.cc/downloads/os_images/rdk_x5/">https://archive.d-robotics.cc/downloads/os_images/rdk_x5/</a></li><ul class="notion-list notion-list-disc notion-block-154f501017f280919521e430ba8524d2"><li>desktop为有界面的</li><li>server为无界面的，资源占用率低</li><li>我下载的是desktop，看看界面啥样</li><li>现在下来的是压缩包，需要解压</li></ul></ul><ul class="notion-list notion-list-disc notion-block-154f501017f280f68100e5513203a153"><li>烧录进sd卡</li></ul><ul class="notion-list notion-list-disc notion-block-154f501017f2802d9adbf2ca1eaf58d5"><li>然后ttl链接电脑，使用终端工具进入命令行，或者你直接使用hdmi连上键盘鼠标才做ui</li></ul><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-154f501017f28149a7dbc3110729f8ab" data-id="154f501017f28149a7dbc3110729f8ab"><span><div id="154f501017f28149a7dbc3110729f8ab" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f28149a7dbc3110729f8ab" title="进入系统"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">进入系统</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-154f501017f280b8b31fca5f116e2304" data-id="154f501017f280b8b31fca5f116e2304"><span><div id="154f501017f280b8b31fca5f116e2304" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f280b8b31fca5f116e2304" title="设置wifi"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">设置wifi</span></span></h3><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-154f501017f2801ca915df7d512f9c85" data-id="154f501017f2801ca915df7d512f9c85"><span><div id="154f501017f2801ca915df7d512f9c85" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f2801ca915df7d512f9c85" title="设置vnc
"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">设置vnc
</span></span></h3><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-154f501017f280cebee9d9ef2cca91d7" href="https://developer.d-robotics.cc/rdk_doc/Quick_start/configuration_wizard?_highlight=vnc#%E5%BC%80%E5%90%AFvnc%E6%9C%8D%E5%8A%A1"><div><div class="notion-bookmark-title">RDK DOC</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><img src="https://www.notion.so/image/https%3A%2F%2Fdeveloper.d-robotics.cc%2Frdk_doc%2Fimg%2Flogo.png?table=block&amp;id=154f5010-17f2-80ce-bee9-d9ef2cca91d7&amp;t=154f5010-17f2-80ce-bee9-d9ef2cca91d7" alt="RDK DOC" loading="lazy" decoding="async"/></div><div class="notion-bookmark-link-text">https://developer.d-robotics.cc/rdk_doc/Quick_start/configuration_wizard?_highlight=vnc#%E5%BC%80%E5%90%AFvnc%E6%9C%8D%E5%8A%A1</div></div></div></a></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f280499c85e67ace1a69e8"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:311px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fb7935fe6-f088-467c-af72-cd1c20a1685d%2Fimage.png?table=block&amp;id=154f5010-17f2-8049-9c85-e67ace1a69e8&amp;t=154f5010-17f2-8049-9c85-e67ace1a69e8&amp;width=311&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f2804fa6fffb6cdd30ee03"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F9ba48b32-c414-490a-baf6-7e23b96c7c0a%2Fimage.png?table=block&amp;id=154f5010-17f2-804f-a6ff-fb6cdd30ee03&amp;t=154f5010-17f2-804f-a6ff-fb6cdd30ee03&amp;width=707.9921875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-154f501017f280de9129de67864696dc"> </div><div class="notion-text notion-block-154f501017f2805c86fde6b9b26c3649">macos可以使用《屏幕共享》直接链接</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f280bcaf6efe918cbe17be"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fb965fbf1-eab5-440a-bf5c-88f1b843b10f%2Fimage.png?table=block&amp;id=154f5010-17f2-80bc-af6e-fe918cbe17be&amp;t=154f5010-17f2-80bc-af6e-fe918cbe17be&amp;width=707.9921875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f28046abaaea286120b26b"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F73bb7a3e-78cb-49ef-9be9-241f14bf7a23%2Fimage.png?table=block&amp;id=154f5010-17f2-8046-abaa-ea286120b26b&amp;t=154f5010-17f2-8046-abaa-ea286120b26b&amp;width=707.984375&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-154f501017f28038ac96c140e53cc7d0" data-id="154f501017f28038ac96c140e53cc7d0"><span><div id="154f501017f28038ac96c140e53cc7d0" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f28038ac96c140e53cc7d0" title="测试ollama"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">测试ollama</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-154f501017f28027bbc8f0b2a69b5e57" data-id="154f501017f28027bbc8f0b2a69b5e57"><span><div id="154f501017f28027bbc8f0b2a69b5e57" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f28027bbc8f0b2a69b5e57" title="安装"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">安装</span></span></h3><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-154f501017f280149161d508012fead1" data-id="154f501017f280149161d508012fead1"><span><div id="154f501017f280149161d508012fead1" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f280149161d508012fead1" title="测试结果"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">测试结果</span></span></h3><div class="notion-text notion-block-154f501017f2804ca15fd4e171174a49">qwen2:0.5b</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f280b196b3f2bd751e1c43"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Ffa0bdaa6-a917-448c-ae91-245a57fbe047%2Fimage.png?table=block&amp;id=154f5010-17f2-80b1-96b3-f2bd751e1c43&amp;t=154f5010-17f2-80b1-96b3-f2bd751e1c43&amp;width=707.9921875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-154f501017f28032b83bf3e8a9e78726">llama3.2:1b</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f280888198ea08d66d7239"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3e3bfb14-7412-435c-a242-c5a80068eeed%2Fimage.png?table=block&amp;id=154f5010-17f2-8088-8198-ea08d66d7239&amp;t=154f5010-17f2-8088-8198-ea08d66d7239&amp;width=707.984375&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-154f501017f280989dfbdca03ae90a7a">moondream:latest</div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f2803ead7dd6b6fa086e39"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:386px;max-width:100%;flex-direction:column"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fdcfcd2ff-9ed6-4c80-9332-8eb993917b5f%2Fimage.png?table=block&amp;id=154f5010-17f2-803e-ad7d-d6b6fa086e39&amp;t=154f5010-17f2-803e-ad7d-d6b6fa086e39&amp;width=386&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-154f501017f280c6afa7fb8847a83eb3"> </div><div class="notion-text notion-block-154f501017f280829694fc14ea7a5cff">图片识别一直在转圈圈，运行不了，应该是现在没有使用BPU加速的原因，我也看不懂，应该ratio是0就是没走BPU吧</div><div class="notion-blank notion-block-154f501017f2802fbdb4ef1db89f66fe"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-154f501017f281618d22e0b367832833" data-id="154f501017f281618d22e0b367832833"><span><div id="154f501017f281618d22e0b367832833" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f281618d22e0b367832833" title="总结"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">总结</span></span></h2><ul class="notion-list notion-list-disc notion-block-154f501017f2814e86d7e07a208d0a5c"><li>没啥难度</li></ul><ul class="notion-list notion-list-disc notion-block-154f501017f280a09a27fb647ce77b0a"><li>BPU到底是啥，算力到底是啥，不清楚这些定义</li></ul><ul class="notion-list notion-list-disc notion-block-154f501017f280c6a5d3fa2a591c3798"><li>在linux服务器上部署大模型的时候可以直接调用to_cuda，直接在gpu加载模型，看了下文档，BPU好像更麻烦一点</li></ul><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-154f501017f281ddb3f6dbff7965c44e" data-id="154f501017f281ddb3f6dbff7965c44e"><span><div id="154f501017f281ddb3f6dbff7965c44e" class="notion-header-anchor"></div><a class="notion-hash-link" href="#154f501017f281ddb3f6dbff7965c44e" title="写到最后"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">写到最后</span></span></h2><div class="notion-row notion-block-154f501017f28104899ffa5e60b7413b"><div class="notion-column notion-block-154f501017f281659399dbd93a29b542" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.25)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f2811897e1d3408a134c33"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fe74a26b9-10d9-49f3-9ea7-bcb2a1438bd7%2Ffavicon.png?table=block&amp;id=154f5010-17f2-8118-97e1-d3408a134c33&amp;t=154f5010-17f2-8118-97e1-d3408a134c33&amp;width=144&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-154f501017f28132a836f5a0cf2b832d" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.34601449275362306)"><div class="notion-text notion-block-154f501017f2810a956adcf89c0d569e"><em>
</em><em><b>        是在往前走就好</b></em><em>
        </em><em><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://bothsavage.github.io/archive">bothsavage.github.io</a></em><em>
</em></div><div class="notion-blank notion-block-154f501017f2813ea14ed7f3b37562ce"> </div></div><div class="notion-spacer"></div><div class="notion-column notion-block-154f501017f28169903fe57b1de55ef1" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.4039855072463767)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-154f501017f28179b660cc67a035080b"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:315px"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3436ffe0-3684-445a-824f-2fd9fa5ad2a6%2FUntitled.png?table=block&amp;id=154f5010-17f2-8179-b660-cc67a035080b&amp;t=154f5010-17f2-8179-b660-cc67a035080b&amp;width=288&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div></div><div class="notion-blank notion-block-154f501017f281b4b825ed13e1e77ab6"> </div></main></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[多模态视频大模型Aria在Docker部署]]></title>
            <link>https://bothsavage.github.io//article/241205-aria</link>
            <guid>https://bothsavage.github.io//article/241205-aria</guid>
            <pubDate>Wed, 04 Dec 2024 16:00:00 GMT</pubDate>
            <description><![CDATA[闲逛HuggingFace的时候发现一个25.3B的多模态大模型，支持图片和视频。刚好我有H20的GPU所以部署来看看效果，因为我的宿主机是cuda-12.1所以为了防止环境污染采用docker部署，通过一系列的披荆斩棘比如Segmentation fault (core dumped)异常，最终成功运行在单卡h20服务器上，python3.10，cuda12.4，ubuntu20.04,程序在推理图片的时候占用50g显存，推理5s视频20fps的时候占用60g左右显存。]]></description>
            <content:encoded><![CDATA[<div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-153f501017f280378e89ecfcb9d24a89"><div class="notion-viewport"></div><div class="notion-collection-page-properties"></div><div class="notion-blank notion-block-153f501017f281bfadb3d889605717a2"> </div><div class="notion-table-of-contents notion-gray notion-block-153f501017f2816aa990fb8c0eea818f"><a href="#153f501017f2815e9e79f98859c710c2" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">契机</span></a><a href="#153f501017f28192ad27e9ac82f28848" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">项目简介</span></a><a href="#153f501017f2802da305dd41a7148b9b" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">线上demo尝试</span></a><a href="#153f501017f2814b8ea8d36f186d5882" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">环境</span></a><a href="#153f501017f280c09d0efd4d3a2a4ba1" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">docker环境</span></a><a href="#153f501017f280e0ab4deb4309efdc32" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">Conda环境</span></a><a href="#153f501017f280a2bdd4e37eafe17e08" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">代码环境</span></a><a href="#153f501017f28028815bfdd9f3f1ec3d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">下载模型</span></a><a href="#153f501017f28025882fcf5e462b2344" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">图片测试</span></a><a href="#153f501017f280cd9995e1067dca7db8" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">代码</span></a><a href="#153f501017f280de89def5660f01c922" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">结果</span></a><a href="#153f501017f280bc8b12fcaa44bc7106" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">视频测试</span></a><a href="#153f501017f2806ea08ec1b69b0af9fc" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">代码</span></a><a href="#153f501017f28006bebed7a8a89a21db" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">结果</span></a><a href="#153f501017f28107a545f2353f0c258e" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">总结</span></a><a href="#153f501017f281248aa7f549beb0e0d5" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">写到最后</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f2815e9e79f98859c710c2" data-id="153f501017f2815e9e79f98859c710c2"><span><div id="153f501017f2815e9e79f98859c710c2" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f2815e9e79f98859c710c2" title="契机"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">契机</span></span></h2><div class="notion-callout notion-gray_background_co notion-block-153f501017f28198a635e9ce3c7251c9"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="⚙">⚙</span></div><div class="notion-callout-text">闲逛HuggingFace的时候发现一个25.3B的多模态大模型，支持图片和视频。刚好我有H20的GPU所以部署来看看效果，因为我的宿主机是cuda-12.1所以为了防止环境污染采用docker部署，通过一系列的披荆斩棘比如Segmentation fault (core dumped)异常，最终成功运行在单卡h20服务器上，python3.10，cuda12.4，ubuntu20.04,程序在推理图片的时候占用50g显存，推理5s视频20fps的时候占用60g左右显存。</div></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f28192ad27e9ac82f28848" data-id="153f501017f28192ad27e9ac82f28848"><span><div id="153f501017f28192ad27e9ac82f28848" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f28192ad27e9ac82f28848" title="项目简介"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">项目简介</span></span></h2><div class="notion-row"><a target="_blank" rel="noopener noreferrer" class="notion-bookmark notion-block-153f501017f2800daad6ce255a7e835c" href="https://huggingface.co/rhymes-ai/Aria"><div><div class="notion-bookmark-title">rhymes-ai/Aria · Hugging Face</div><div class="notion-bookmark-description">We’re on a journey to advance and democratize artificial intelligence through open source and open science.</div><div class="notion-bookmark-link"><div class="notion-bookmark-link-icon"><img src="https://www.notion.so/image/https%3A%2F%2Fhuggingface.co%2Ffavicon.ico?table=block&amp;id=153f5010-17f2-800d-aad6-ce255a7e835c&amp;t=153f5010-17f2-800d-aad6-ce255a7e835c" alt="rhymes-ai/Aria · Hugging Face" loading="lazy" decoding="async"/></div><div class="notion-bookmark-link-text">https://huggingface.co/rhymes-ai/Aria</div></div></div><div class="notion-bookmark-image"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fcdn-thumbnails.huggingface.co%2Fsocial-thumbnails%2Fmodels%2Frhymes-ai%2FAria.png?table=block&amp;id=153f5010-17f2-800d-aad6-ce255a7e835c&amp;t=153f5010-17f2-800d-aad6-ce255a7e835c" alt="rhymes-ai/Aria · Hugging Face" loading="lazy" decoding="async"/></div></a></div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f2802da305dd41a7148b9b" data-id="153f501017f2802da305dd41a7148b9b"><span><div id="153f501017f2802da305dd41a7148b9b" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f2802da305dd41a7148b9b" title="线上demo尝试"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">线上demo尝试</span></span></h3><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-153f501017f28090b008ffff1428c651"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F9c112b2f-3a14-4c0c-8b9c-bab8f74e40ae%2Fimage.png?table=block&amp;id=153f5010-17f2-8090-b008-ffff1428c651&amp;t=153f5010-17f2-8090-b008-ffff1428c651&amp;width=707.9921875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><blockquote class="notion-quote notion-block-153f501017f2815da821e9ae71a0df2a"><div>线上demo响应很快，并且描述得很详细，并且可以描述什么时间发生了啥，介绍里面说的是：Cutting a long video by scene transitions with timestamps.(通过带有时间戳的场景过渡来剪切长视频。),这不是自动剪分镜吗，我有一个好想法先写完这篇再说</div></blockquote><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f2814b8ea8d36f186d5882" data-id="153f501017f2814b8ea8d36f186d5882"><span><div id="153f501017f2814b8ea8d36f186d5882" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f2814b8ea8d36f186d5882" title="环境"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">环境</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f280c09d0efd4d3a2a4ba1" data-id="153f501017f280c09d0efd4d3a2a4ba1"><span><div id="153f501017f280c09d0efd4d3a2a4ba1" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f280c09d0efd4d3a2a4ba1" title="docker环境"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">docker环境</span></span></h3><blockquote class="notion-quote notion-block-153f501017f28009b6afc84461a2f7ce"><div>宿主机cuda是12.4以上的可以忽略，宿主机可以随便升降级cuda的也可以忽略要不然会出现以下异常：ImportError: /usr/local/lib/python3.10/dist-packages/torch/lib/../../nvidia/cusparse/lib/libcusparse.so.12: undefined symbol: __nvJitLinkComplete_12_4, version libnvJitLink.so.12</div></blockquote><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f280e0ab4deb4309efdc32" data-id="153f501017f280e0ab4deb4309efdc32"><span><div id="153f501017f280e0ab4deb4309efdc32" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f280e0ab4deb4309efdc32" title="Conda环境"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">Conda环境</span></span></h3><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f280a2bdd4e37eafe17e08" data-id="153f501017f280a2bdd4e37eafe17e08"><span><div id="153f501017f280a2bdd4e37eafe17e08" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f280a2bdd4e37eafe17e08" title="代码环境"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">代码环境</span></span></h3><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f28028815bfdd9f3f1ec3d" data-id="153f501017f28028815bfdd9f3f1ec3d"><span><div id="153f501017f28028815bfdd9f3f1ec3d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f28028815bfdd9f3f1ec3d" title="下载模型"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">下载模型</span></span></h2><blockquote class="notion-quote notion-block-153f501017f280e58c9cc416dccbf805"><div>本来测试代码可以自动下载，我喜欢放在指定目录，所以搞了个脚本下载</div></blockquote><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f28025882fcf5e462b2344" data-id="153f501017f28025882fcf5e462b2344"><span><div id="153f501017f28025882fcf5e462b2344" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f28025882fcf5e462b2344" title="图片测试"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">图片测试</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f280cd9995e1067dca7db8" data-id="153f501017f280cd9995e1067dca7db8"><span><div id="153f501017f280cd9995e1067dca7db8" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f280cd9995e1067dca7db8" title="代码"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">代码</span></span></h3><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f280de89def5660f01c922" data-id="153f501017f280de89def5660f01c922"><span><div id="153f501017f280de89def5660f01c922" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f280de89def5660f01c922" title="结果"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">结果</span></span></h3><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-153f501017f280998e22c9b5bf21c875"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F8d313197-0edd-4eab-ac08-8da85d61ad1b%2Fimage.png?table=block&amp;id=153f5010-17f2-8099-8e22-c9b5bf21c875&amp;t=153f5010-17f2-8099-8e22-c9b5bf21c875&amp;width=707.9921875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f280bc8b12fcaa44bc7106" data-id="153f501017f280bc8b12fcaa44bc7106"><span><div id="153f501017f280bc8b12fcaa44bc7106" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f280bc8b12fcaa44bc7106" title="视频测试"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">视频测试</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f2806ea08ec1b69b0af9fc" data-id="153f501017f2806ea08ec1b69b0af9fc"><span><div id="153f501017f2806ea08ec1b69b0af9fc" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f2806ea08ec1b69b0af9fc" title="代码"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">代码</span></span></h3><ul class="notion-list notion-list-disc notion-block-153f501017f2809989a1c03411933f08"><li>我是分析/home/下面的所有视频，你要分析单个改改就行</li></ul><ul class="notion-list notion-list-disc notion-block-153f501017f280ee9362e43729e68390"><li>max_image_size可改成490</li></ul><ul class="notion-list notion-list-disc notion-block-153f501017f280aba469cf08a8dc8ceb"><li>num_frames你根据自己视频来选，我的5秒视频，分析20fps，相当于一秒4fps</li></ul><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-153f501017f28006bebed7a8a89a21db" data-id="153f501017f28006bebed7a8a89a21db"><span><div id="153f501017f28006bebed7a8a89a21db" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f28006bebed7a8a89a21db" title="结果"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">结果</span></span></h3><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-153f501017f28005b710dfd579b4cd56"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F5cf3e7cf-1999-42c5-b5f0-53756ecffa82%2Fimage.png?table=block&amp;id=153f5010-17f2-8005-b710-dfd579b4cd56&amp;t=153f5010-17f2-8005-b710-dfd579b4cd56&amp;width=707.9921875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f28107a545f2353f0c258e" data-id="153f501017f28107a545f2353f0c258e"><span><div id="153f501017f28107a545f2353f0c258e" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f28107a545f2353f0c258e" title="总结"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">总结</span></span></h2><ul class="notion-list notion-list-disc notion-block-153f501017f28179bb5eeb5b425a5aa4"><li>aria显存占用还可以，60g左右，好像默认使用的是attn_implementation=<b>&quot;flash_attention_2&quot;</b></li></ul><ul class="notion-list notion-list-disc notion-block-153f501017f280fc9f34eddb4e258347"><li>对比qwen和cpm来说，可以做到：通过带有时间戳的场景过渡来剪切长视频</li></ul><ul class="notion-list notion-list-disc notion-block-153f501017f2804e8c1dfae79ab1e865"><li>core dumped调整下import就行</li></ul><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-153f501017f281248aa7f549beb0e0d5" data-id="153f501017f281248aa7f549beb0e0d5"><span><div id="153f501017f281248aa7f549beb0e0d5" class="notion-header-anchor"></div><a class="notion-hash-link" href="#153f501017f281248aa7f549beb0e0d5" title="写到最后"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">写到最后</span></span></h2><div class="notion-row notion-block-153f501017f28107a1fbf004f4a21a2e"><div class="notion-column notion-block-153f501017f28145a6a6f9b118814e2f" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.25)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-153f501017f28180a9acedd2c0196954"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fe74a26b9-10d9-49f3-9ea7-bcb2a1438bd7%2Ffavicon.png?table=block&amp;id=153f5010-17f2-8180-a9ac-edd2c0196954&amp;t=153f5010-17f2-8180-a9ac-edd2c0196954&amp;width=144&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-153f501017f281a49e8cfd69c83fd724" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.34601449275362306)"><div class="notion-text notion-block-153f501017f28179aa20f5ac2af25e96"><em>
</em><em><b>        是在往前走就好</b></em><em>
        </em><em><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://bothsavage.github.io/archive">bothsavage.github.io</a></em><em>
</em></div><div class="notion-blank notion-block-153f501017f281c185bfe0775f43be89"> </div></div><div class="notion-spacer"></div><div class="notion-column notion-block-153f501017f2815a8f41c62e5e861c52" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.4039855072463767)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-153f501017f281c4ba73d464ec0a661c"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:315px"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3436ffe0-3684-445a-824f-2fd9fa5ad2a6%2FUntitled.png?table=block&amp;id=153f5010-17f2-81c4-ba73-d464ec0a661c&amp;t=153f5010-17f2-81c4-ba73-d464ec0a661c&amp;width=288&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div></div><div class="notion-blank notion-block-153f501017f28172a6b3c4996362c96e"> </div></main></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Mac平台M1PRO芯片MiniCPM-V-2.6网页部署跑通]]></title>
            <link>https://bothsavage.github.io//article/240810-minicpm2.6</link>
            <guid>https://bothsavage.github.io//article/240810-minicpm2.6</guid>
            <pubDate>Fri, 09 Aug 2024 16:00:00 GMT</pubDate>
            <description><![CDATA[2.6的小钢炮可以输入视频了，我必须拉到本地跑跑。主要解决2.6版本默认绑定flash_atten问题，pip install flash_attn也无法安装，因为强制依赖cuda。主要解决的就是这个问题，还有 BFloat16 is not supported on MPS问题解决。]]></description>
            <content:encoded><![CDATA[<div id="notion-article" class="mx-auto overflow-hidden "><main class="notion light-mode notion-page notion-block-a741252ce46b4342998c58ebc362fc0d"><div class="notion-viewport"></div><div class="notion-collection-page-properties"></div><div class="notion-blank notion-block-353f48cab3fc467898c3b5d7f06893a1"> </div><div class="notion-table-of-contents notion-gray notion-block-578e66a95159477ca68b9c0768517457"><a href="#2da7371dc14942f08d8c61c40c96eb22" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">契机</span></a><a href="#e072817841e945a4913f261fbf4f1262" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">环境</span></a><a href="#f6e5b6acf8994d53950e0a0cf8818227" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">解决问题</span></a><a href="#0d831cbcd9af470ba411ebcca1ca7d8f" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">效果展示</span></a><a href="#ad8919a2ea5b49b0ba259cc660e3f84d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">图片理解</span></a><a href="#638b36be4dd74e4b9b2b9df3b7511ccf" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:24px">视频理解</span></a><a href="#4f9b8cdc894b4fb48f2b62914f8a2ed6" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">系统占用</span></a><a href="#cb00684eeea649f08d5b420d7adfc9c4" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">总结</span></a><a href="#4d8a642c19cc459db2d3cf032e9de29d" class="notion-table-of-contents-item"><span class="notion-table-of-contents-item-body" style="display:inline-block;margin-left:0">写到最后</span></a></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-2da7371dc14942f08d8c61c40c96eb22" data-id="2da7371dc14942f08d8c61c40c96eb22"><span><div id="2da7371dc14942f08d8c61c40c96eb22" class="notion-header-anchor"></div><a class="notion-hash-link" href="#2da7371dc14942f08d8c61c40c96eb22" title="契机"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">契机</span></span></h2><div class="notion-callout notion-gray_background_co notion-block-b833e55e3644417bb1192b7e701d982b"><div class="notion-page-icon-inline notion-page-icon-span"><span class="notion-page-icon" role="img" aria-label="⚙">⚙</span></div><div class="notion-callout-text"><b>2.6的小钢炮可以输入视频了，我必须拉到本地跑跑。主要解决2.6版本默认绑定flash_atten问题，pip install flash_attn也无法安装，因为强制依赖cuda。主要解决的就是这个问题，还有 BFloat16 is not supported on MPS问题解决。</b></div></div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-e072817841e945a4913f261fbf4f1262" data-id="e072817841e945a4913f261fbf4f1262"><span><div id="e072817841e945a4913f261fbf4f1262" class="notion-header-anchor"></div><a class="notion-hash-link" href="#e072817841e945a4913f261fbf4f1262" title="环境"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">环境</span></span></h2><ul class="notion-list notion-list-disc notion-block-edd31627e335458d8b07b3e34c6220fc"><li>macos版本：版本15.0 Beta版(24A5279h) || 版本15.1 Beta版(24B5009l)</li></ul><ul class="notion-list notion-list-disc notion-block-79154f39c44c40b39f3f4f88594e535d"><li>芯片：m1 pro</li></ul><ul class="notion-list notion-list-disc notion-block-d3146880760d480698ef6e20feed3dd5"><li>代码仓库：<a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://github.com/OpenBMB/MiniCPM-V.git">https://github.com/OpenBMB/MiniCPM-V.git</a> </li></ul><ul class="notion-list notion-list-disc notion-block-498f5336b164447eb4fae05ae150fb8e"><li>分支：main</li></ul><ul class="notion-list notion-list-disc notion-block-274203d7c350480fb62913aaac63f699"><li>代码版本：b0125d8a yiranyyu <a target="_blank" rel="noopener noreferrer" class="notion-link" href="mailto:2606375857@qq.com">2606375857@qq.com</a> on 2024/8/9 at 10:25</li></ul><ul class="notion-list notion-list-disc notion-block-c015d46e94a2453ebd8fdd58e08293d4"><li>python版本：3.9</li></ul><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-f6e5b6acf8994d53950e0a0cf8818227" data-id="f6e5b6acf8994d53950e0a0cf8818227"><span><div id="f6e5b6acf8994d53950e0a0cf8818227" class="notion-header-anchor"></div><a class="notion-hash-link" href="#f6e5b6acf8994d53950e0a0cf8818227" title="解决问题"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">解决问题</span></span></h2><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-adf5bdca446a47d58a75bce9d9df5311"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F1078b627-6a78-45ba-9698-d2e60ccffeb7%2FUntitled.png?table=block&amp;id=adf5bdca-446a-47d5-8a75-bce9d9df5311&amp;t=adf5bdca-446a-47d5-8a75-bce9d9df5311&amp;width=708&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-a09e7cd304ac4b00a4af48e1429567ea"> </div><div class="notion-blank notion-block-f4653275f19248f18595719729ebcca3"> </div><div class="notion-blank notion-block-761ff9e927c04aea9bbde0240fb5961b"> </div><div class="notion-text notion-block-39e03a978ceb4215b025afb99b4e050b">完整代码如下</div><div class="notion-blank notion-block-249a6c9f6078479094814a8936b4aaef"> </div><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-0d831cbcd9af470ba411ebcca1ca7d8f" data-id="0d831cbcd9af470ba411ebcca1ca7d8f"><span><div id="0d831cbcd9af470ba411ebcca1ca7d8f" class="notion-header-anchor"></div><a class="notion-hash-link" href="#0d831cbcd9af470ba411ebcca1ca7d8f" title="效果展示"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">效果展示</span></span></h2><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-ad8919a2ea5b49b0ba259cc660e3f84d" data-id="ad8919a2ea5b49b0ba259cc660e3f84d"><span><div id="ad8919a2ea5b49b0ba259cc660e3f84d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#ad8919a2ea5b49b0ba259cc660e3f84d" title="图片理解"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">图片理解</span></span></h3><div class="notion-text notion-block-65a0ac3461d846b89955bec143fe9f2f"><b>Sampling解码</b></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-c37abb66d61e46f9b5ceae513a8ca313"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F6d5c217a-9a64-4bb6-abc3-276f4fcc9147%2FUntitled.png?table=block&amp;id=c37abb66-d61e-46f9-b5ce-ae513a8ca313&amp;t=c37abb66-d61e-46f9-b5ce-ae513a8ca313&amp;width=2736&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-f24f87ceb2a9451188d7a7ccac0d50f0"> </div><div class="notion-text notion-block-9e745960d7064037b9235fc019e55bd0"><b>Beam Search解码</b></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-cc59ffa3cf59440ab7d6e7c922926f9c"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fba8e5b54-ed5c-4585-a76b-74634b03ea3a%2FUntitled.png?table=block&amp;id=cc59ffa3-cf59-440a-b7d6-e7c922926f9c&amp;t=cc59ffa3-cf59-440a-b7d6-e7c922926f9c&amp;width=708&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-blank notion-block-e66d6581d12e4e6e9d3aa90dff76c17e"> </div><h3 class="notion-h notion-h2 notion-h-indent-1 notion-block-638b36be4dd74e4b9b2b9df3b7511ccf" data-id="638b36be4dd74e4b9b2b9df3b7511ccf"><span><div id="638b36be4dd74e4b9b2b9df3b7511ccf" class="notion-header-anchor"></div><a class="notion-hash-link" href="#638b36be4dd74e4b9b2b9df3b7511ccf" title="视频理解"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">视频理解</span></span></h3><div class="notion-text notion-block-6983fd376adf49d584457f4fdc6f2567"><b>Sampling解码</b></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-843b764bb77042febbd2569cd362f626"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F509facee-40c3-4e9a-9f39-156a50f93449%2FUntitled.png?table=block&amp;id=843b764b-b770-42fe-bbd2-569cd362f626&amp;t=843b764b-b770-42fe-bbd2-569cd362f626&amp;width=708&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><div class="notion-text notion-block-1e7f3f970719415b841f2108e985bb42"><b>Beam Search解码</b></div><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-aae2d5a0071e4b5dae29340d8cf3d9f6"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3dd98266-9a13-454f-ba57-9499f9c01066%2FUntitled.png?table=block&amp;id=aae2d5a0-071e-4b5d-ae29-340d8cf3d9f6&amp;t=aae2d5a0-071e-4b5d-ae29-340d8cf3d9f6&amp;width=2644&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-4f9b8cdc894b4fb48f2b62914f8a2ed6" data-id="4f9b8cdc894b4fb48f2b62914f8a2ed6"><span><div id="4f9b8cdc894b4fb48f2b62914f8a2ed6" class="notion-header-anchor"></div><a class="notion-hash-link" href="#4f9b8cdc894b4fb48f2b62914f8a2ed6" title="系统占用"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">系统占用</span></span></h2><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-60554234affb4b859ae7edbd16fe481a"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F5cbfad6e-d668-483b-bef3-000459c03aae%2FUntitled.png?table=block&amp;id=60554234-affb-4b85-9ae7-edbd16fe481a&amp;t=60554234-affb-4b85-9ae7-edbd16fe481a&amp;width=632.96875&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-cb00684eeea649f08d5b420d7adfc9c4" data-id="cb00684eeea649f08d5b420d7adfc9c4"><span><div id="cb00684eeea649f08d5b420d7adfc9c4" class="notion-header-anchor"></div><a class="notion-hash-link" href="#cb00684eeea649f08d5b420d7adfc9c4" title="总结"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">总结</span></span></h2><ul class="notion-list notion-list-disc notion-block-75330c0c61a440b6913b8153b1602600"><li>解决flash_attn强制依赖问题</li></ul><ul class="notion-list notion-list-disc notion-block-912ea1fc408f4d0ca2683809bef620d2"><li>解决bfloat16在mps无法使用问题</li></ul><ul class="notion-list notion-list-disc notion-block-c5713ee5cf254c408dc9916bacf6b979"><li>看系统占用是没走mps，添加的环境变量也可以看出</li></ul><ul class="notion-list notion-list-disc notion-block-45f924a5d0b54dbca33d89bbccbf07a2"><li>Sampling瞎回答，Beam Search回答很惊喜</li></ul><ul class="notion-list notion-list-disc notion-block-383f96c3c07b4a659b1d37dc141ed53d"><li>Beam Search处理视频4秒，在m1pro下，当前代码中需要230s左右</li></ul><ul class="notion-list notion-list-disc notion-block-1f96f3d3a4af4472804eb262f9931543"><li>ollama部署还在研究中…</li></ul><h2 class="notion-h notion-h1 notion-h-indent-0 notion-block-4d8a642c19cc459db2d3cf032e9de29d" data-id="4d8a642c19cc459db2d3cf032e9de29d"><span><div id="4d8a642c19cc459db2d3cf032e9de29d" class="notion-header-anchor"></div><a class="notion-hash-link" href="#4d8a642c19cc459db2d3cf032e9de29d" title="写到最后"><svg viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a><span class="notion-h-title">写到最后</span></span></h2><div class="notion-row notion-block-1969bb195b8c4ea78f4bd7e7058d552b"><div class="notion-column notion-block-00dd203fd69849f1a264a98fd91ee33f" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.25)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-f401f084c0b94973a8ab78a78d2ae419"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:100%"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2Fe74a26b9-10d9-49f3-9ea7-bcb2a1438bd7%2Ffavicon.png?table=block&amp;id=f401f084-c0b9-4973-a8ab-78a78d2ae419&amp;t=f401f084-c0b9-4973-a8ab-78a78d2ae419&amp;width=144&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div><div class="notion-column notion-block-663dd858718c4e0b93b3d6ff381f7391" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.34601449275362306)"><div class="notion-text notion-block-20ed1c34d3c14807a7c52a14d307c690"><em>
</em><em><b>        是在往前走就好</b></em><em>
        </em><em><a target="_blank" rel="noopener noreferrer" class="notion-link" href="https://bothsavage.github.io/archive">bothsavage.github.io</a></em><em>
</em></div><div class="notion-blank notion-block-b3f6c0a9cb814aaa9a1cee4dea607ebb"> </div></div><div class="notion-spacer"></div><div class="notion-column notion-block-c627e8a5548a4cfe91ca777942a40b2f" style="width:calc((100% - (2 * min(32px, 4vw))) * 0.4039855072463767)"><figure class="notion-asset-wrapper notion-asset-wrapper-image notion-block-bf87d52aa90141bc99f4ec9c67dc647e"><div style="position:relative;display:flex;justify-content:center;align-self:center;width:100%;max-width:100%;flex-direction:column;height:315px"><img style="object-fit:cover" src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Feb3e1328-8f32-4ff5-8d18-8ea80020e175%2F3436ffe0-3684-445a-824f-2fd9fa5ad2a6%2FUntitled.png?table=block&amp;id=bf87d52a-a901-41bc-99f4-ec9c67dc647e&amp;t=bf87d52a-a901-41bc-99f4-ec9c67dc647e&amp;width=288&amp;cache=v2" alt="notion image" loading="lazy" decoding="async"/></div></figure></div><div class="notion-spacer"></div></div><div class="notion-blank notion-block-b2819630b50b4c3ebc93c429638a9375"> </div></main></div>]]></content:encoded>
        </item>
    </channel>
</rss>